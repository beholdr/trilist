<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Trilist</title>

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%220.9em%22 font-size=%22120%22>☘️</text></svg>">
  <style>
    /*:not(:defined) {
      visibility: hidden;
    }*/

    html {
      color: #888;
      font-size: 12px;

      /* color-scheme: dark; */

      /* Overrides */
      /*
      --trilist-color-primary: rgb(220, 45, 75);
      --trilist-color-secondary: rgb(229, 231, 235);
      --trilist-color-input: rgb(255, 255, 255);
      --trilist-color-fone: rgb(255, 255, 255);
      --trilist-color-gray: rgb(156, 163, 175);
      --trilist-color-gray-alt: rgb(107, 114, 128);
      --trilist-border-radius: 0;
      --trilist-text-base: 16px;
      --trilist-text-sm: 14px;
      */

      /*
      --trilist-color-secondary: rgb(76, 76, 76);
      --trilist-color-input: rgb(46, 46, 46);
      --trilist-color-fone: rgb(28, 28, 28);
      --trilist-color-gray: rgb(96, 103, 114);
      --trilist-color-gray-alt: rgb(128, 136, 153);
      */
    }

    #app {
      color: #333;
      margin: 1.5em auto;
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      column-gap: 16px;
    }
    /*trilist-view {
      font-size: 12px;
    }*/
  </style>
</head>

<body>
  <p>Examples:</p>
  <div id="app">
    <trilist-view id="trilist-1" style="--trilist-color-primary: rgb(220, 45, 75); --trilist-border-radius: 0"
      selectable multiselect filter leafs></trilist-view>

    <trilist-view id="trilist-2" animated></trilist-view>

    <trilist-select id="trilist-3" placeholder="Выберите свою специальность тут" filter-placeholder="Поиск..."
      select-button="Выбрать" cancel-button="Отменить" multiselect filter animated></trilist-select>

    <trilist-select id="trilist-4"></trilist-select>
  </div>

  <script type="module">
    const tree1 = [
      {
        id: 1,
        label: "Category 1",
        children: [
          { id: "11", label: "Leaf 11" },
          { id: "12", label: "Leaf xx 12" },
        ],
      },
      {
        id: "2",
        label: "Category 2",
        children: [
          { id: "11", label: "Leaf 11" },
          {
            id: "21", label: "Category with very long name zzz 21", children: [
              { id: "11", label: "Leaf 11" },
              { id: "211", label: "Leaf with very long name too 211" },
              { id: "212", label: "Leaf 212" },
            ]
          },
        ],
      },
      {
        id: "3",
        label: "Category 3"
      },
      {
        id: "4",
        label: "Category 4",
        children: [
          { id: "41", label: "Leaf 41" },
        ]
      },
      {
        id: "5",
        label: "Category 5",
        children: [
          { id: "51", label: "Leaf 51" },
          { id: "52", label: "Leaf xxx 52" }
        ]
      },
    ];
    const tree2 = JSON.parse(JSON.stringify(tree1))
    tree2.push({ id: 6, label: "Category 6" })

    const convertData = (data) => {
      const result = []
      for (const item of data.data) {
        if (!item.parents.length) {
          result.push({ id: item.id, label: item.title })
        } else {
          for (const parent of item.parents) {
            const idx = result.findIndex(el => el.id === parent.id)
            if (!result[idx].children) {
              result[idx].children = []
            }
            result[idx].children.push({ id: item.id, label: item.title })
          }
        }
      }

      return result
    }

    await Promise.allSettled([
      customElements.whenDefined('trilist-view'),
      customElements.whenDefined('trilist-select'),
    ])

    const el1 = document.getElementById('trilist-1')
    el1.init({
      items: tree1,
      selected: ['12', '3', '4'],
      expanded: ['1']
    })
    el1.addEventListener('trilist-change', (e) => console.log(e.detail))

    const el2 = document.getElementById('trilist-2')
    el2.init({
      items: tree2,
      expanded: ['2', '2-21'],
      labelHook: (item) => item.label + ' → <a style="text-decoration: underline" href="' + item.id + '">edit</a>'
    })

    const el3 = document.getElementById('trilist-3')
    fetch('https://rbtu.ru/api/professions')
      .then(res => res.json())
      .then(data => {
        el3.init({
          items: convertData(data),
          selected: [29, 30, 31, 145]
        })
      })
    el3.addEventListener('trilist-change', (e) => console.log(e.detail))

    const el4 = document.getElementById('trilist-4')
    el4.init({ items: tree2 })
  </script>

  <script type="module" src="/src/main.ts"></script>
</body>

</html>
