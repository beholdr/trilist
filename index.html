<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Trilist</title>

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%220.9em%22 font-size=%22120%22>☘️</text></svg>">
  <style>
    html {
      color: #888;
      font-size: 12px;

      /* Overrides */
      --trilist-color-primary: rgb(220, 45, 75);
      --trilist-color-linecolor: rgb(156, 163, 175);
      --trilist-color-linecolor2: rgb(107, 114, 128);
      --trilist-border-radius: 0;
    }

    #app {
      margin: 1.5em auto;
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5em;
    }
  </style>
</head>

<body>
  <p>Examples:</p>
  <div id="app">
    <trilist-view id="trilist-1" selected='["12"]' expanded='["1"]' selectable multiselect filter
      tree-controls></trilist-view>

    <trilist-view id="trilist-2"></trilist-view>

    <trilist-select id="trilist-3" selected='["12"]' expanded='["1"]' placeholder="Выберите специальность"
      filter-placeholder="Поиск..." multiselect filter></trilist-select>

    <trilist-select id="trilist-4"></trilist-select>
  </div>

  <script type="module" src="/src/main.ts"></script>

  <script>
    const tree1 = [
      {
        id: 1,
        label: "Category 1",
        children: [
          { id: "11", label: "Leaf 11" },
          { id: "12", label: "Leaf xx 12" },
        ],
      },
      {
        id: "2",
        label: "Category 2",
        children: [
          { id: "11", label: "Leaf 11" },
          {
            id: "21", label: "Category zzz 21", children: [
              { id: "11", label: "Leaf 11" },
              { id: "211", label: "Leaf 211" },
              { id: "212", label: "Leaf 212" },
            ]
          },
        ],
      },
      {
        id: "3",
        label: "Category 3"
      },
      {
        id: "4",
        label: "Category 4",
        children: [
          { id: "41", label: "Leaf 41" },
          { id: "42", label: "Leaf xxx 42" }
        ]
      },
    ];
    const tree2 = JSON.parse(JSON.stringify(tree1))
    tree2.push({ id: 5, label: "Category 5" })

    /* const tree = []
    for (let i = 1; i < 100; i++) {
      const item = {
        id: i,
        label: 'Category ' + i,
        children: []
      }


      for (let ii = 1; ii < 50; ii++) {
        item.children.push({
          id: `l-${i}-${ii}`,
          label: 'Label ' + ii
        })
      }

      tree.push(item)
    } */

    const convertData = (data) => {
      const result = []
      for (item of data.data) {
        if (!item.parents.length) {
          result.push({ id: item.id, label: item.title })
        } else {
          for (parent of item.parents) {
            const idx = result.findIndex(el => el.id === parent.id)
            if (!result[idx].children) {
              result[idx].children = []
            }
            result[idx].children.push({ id: item.id, label: item.title })
          }
        }
      }

      return result
    }

    const el1 = document.getElementById('trilist-1')
    el1.addEventListener('connect', (e) => {
      // fetch('https://rbtu.ru/api/regions')
      //   .then(res => res.json())
      //   .then(data => {
      //     e.detail.el.init({
      //       items: convertData(data)
      //     })
      //   })
      e.detail.el.init({
        items: tree1,
      })
    })
    el1.addEventListener('select', (e) => console.log({ select: e }))

    const el2 = document.getElementById('trilist-2')
    el2.addEventListener('connect', (e) => {
      e.detail.el.init({
        items: tree2,
        labelHook: (item) => item.label + ' → <a style="text-decoration: underline" href="' + item.id + '">edit</a>'
      })
    })

    const el3 = document.getElementById('trilist-3')
    el3.addEventListener('connect', (e) => {
      fetch('https://rbtu.ru/api/professions')
        .then(res => res.json())
        .then(data => {
          e.detail.el.init({
            items: convertData(data)
          })
        })
    })
    el3.addEventListener('select', (e) => console.log({ select: e }))

    const el4 = document.getElementById('trilist-4')
    el4.addEventListener('connect', (e) => {
      e.detail.el.init({
        items: tree2
      })
    })
  </script>
</body>

</html>
